"use strict";(self.webpackChunk_deriv_account=self.webpackChunk_deriv_account||[]).push([["Sections_Security_ApiToken_index_ts"],{"./Components/article/index.ts":(e,s,t)=>{t.d(s,{A:()=>r});var a=t("react"),n=t("@deriv/components"),i=t("@deriv-com/translations"),o=t("../../../node_modules/clsx/dist/clsx.mjs"),l=t("../../../node_modules/react/jsx-runtime.js");const r=e=>{let{title:s,descriptions:t,onClickLearnMore:r,className:c}=e;const d=t?.length>0,_=1===t?.length;return(0,l.jsxs)("article",{className:(0,o.A)("da-article",c),children:[(0,l.jsx)(n.Text,{as:"h4",color:"prominent",line_height:"m",size:"xs",weight:"bold",className:"da-article__header",children:s}),d&&(0,l.jsx)(a.Fragment,{children:_?(0,l.jsx)(n.Text,{as:"p",size:"xxs",line_height:"m",children:t[0]}):(0,l.jsx)("ul",{className:"da-article__list",children:t.map(((e,s)=>(0,l.jsx)("li",{children:(0,l.jsx)(n.Text,{size:"xxs",line_height:"xs",children:e})},s)))})}),r&&(0,l.jsxs)("div",{className:"da-article__learn-more",onClick:r,children:[(0,l.jsx)(n.Text,{size:"xxs",color:"loss-danger",line_height:"s",children:(0,l.jsx)(i.Localize,{i18n_default_text:"Learn more"})}),(0,l.jsx)(n.Icon,{icon:"IcChevronRight",className:"da-article__learn-more-icon",color:"red"})]})]})}},"./Sections/Security/ApiToken/index.ts":(e,s,t)=>{t.r(s),t.d(s,{default:()=>I});var a=t("react"),n=t("../../../node_modules/clsx/dist/clsx.mjs"),i=t("formik"),o=t("@deriv/components"),l=t("../../../node_modules/@deriv-com/ui/dist/hooks/useDevice.js"),r=t("@deriv/shared"),c=t("@deriv/stores"),d=t("@deriv-com/translations"),_=t("./Components/article/index.ts"),x=t("../../../node_modules/react/jsx-runtime.js");const m=()=>(0,x.jsx)(_.A,{title:(0,x.jsx)(d.Localize,{i18n_default_text:"API token"}),descriptions:[(0,x.jsx)(d.Localize,{i18n_default_text:"To access your mobile apps and other third-party apps, you'll first need to generate an API token."},0)]}),p=e=>{let{name:s,display_name:t,description:a,children:n}=e;return(0,x.jsx)(i.Field,{name:s,children:e=>{let{field:i,form:{setFieldValue:l}}=e;return(0,x.jsx)(o.CompositeCheckbox,{...i,onChange:()=>l(s,!i.value),className:"api-token__checkbox",label:t,description:a,children:n})}})},u=e=>{let{message:s}=e;return(0,x.jsxs)("div",{className:"da-api-token__bullet-wrapper",children:[(0,x.jsx)("div",{className:"da-api-token__bullet"}),(0,x.jsx)(o.Text,{as:"p",color:"prominent ",size:"xs",line_height:"m",children:s})]})},h=()=>(0,x.jsxs)(a.Fragment,{children:[(0,x.jsx)(o.Text,{as:"p",color:"prominent ",size:"xs",line_height:"m",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Be careful who you share this token with. Anyone with this token can perform the following actions on your account behalf"})}),(0,x.jsxs)("div",{className:"da-api-token__bullet-container",children:[(0,x.jsx)(u,{message:(0,x.jsx)(d.Localize,{i18n_default_text:"Add accounts"})}),(0,x.jsx)(u,{message:(0,x.jsx)(d.Localize,{i18n_default_text:"Create or delete API tokens for trading and withdrawals"})}),(0,x.jsx)(u,{message:(0,x.jsx)(d.Localize,{i18n_default_text:"Modify account settings"})})]})]}),j=e=>{let{scopes:s,text_copy:t,info_message:n,success_message:i,popover_alignment:l="bottom"}=e;const[c,_,m]=(0,o.useCopyToClipboard)(),[p,u]=(0,a.useState)(!1),[j,k]=(0,a.useState)(!1),g=(0,r.useIsMounted)();let f,y;const b=s?.includes("Admin"),v=()=>{u(!1),_(t??""),k(!0),f=setTimeout((()=>{g()&&(k(!1),m(!1))}),1900),y=setTimeout((()=>{g()&&m(!1)}),2050)};return(0,a.useEffect)((()=>()=>{clearTimeout(f),clearTimeout(y)}),[f,y]),(0,x.jsxs)(a.Fragment,{children:[(0,x.jsxs)(o.Modal,{is_open:p,small:!0,children:[(0,x.jsx)(o.Modal.Body,{children:(0,x.jsx)(h,{})}),(0,x.jsx)(o.Modal.Footer,{className:"da-api-token__modal-footer",children:(0,x.jsx)(o.Button,{className:"dc-dialog__button",has_effect:!0,onClick:v,primary:!0,large:!0,children:(0,x.jsx)(d.Localize,{i18n_default_text:"OK"})})})]}),(0,x.jsx)(o.Popover,{alignment:l,classNameBubble:"dc-clipboard__popover",message:c?i:n,is_open:j,zIndex:"9999",children:(0,x.jsx)(o.Icon,{icon:c?"IcCheckmarkCircle":"IcClipboard",custom_color:c?"var(--status-success)":"var(--text-prominent)",className:"dc-clipboard",size:14,data_testid:c?"dt_token_copied_icon":"dt_copy_token_icon",onClick:()=>{b?u(!0):v()},onMouseEnter:()=>{c||k(!0)},onMouseLeave:()=>{c||k(!1)}})})]})},k=(0,a.createContext)({api_tokens:[],deleteToken:()=>Promise.resolve()}),g=e=>{let{token:s,popover_alignment:t="left"}=e;const{isDesktop:n}=(0,l.Y)(),{deleteToken:i}=(0,a.useContext)(k),[c,_]=(0,a.useState)(!1),[m,p]=(0,a.useState)(!1),[u,h]=(0,a.useState)(!1),j=(0,r.useIsMounted)();return(0,x.jsxs)(a.Fragment,{children:[(0,x.jsxs)(o.Modal,{is_open:c,small:!0,children:[(0,x.jsxs)(o.Modal.Body,{children:[(0,x.jsx)(o.Text,{as:"h1",color:"prominent",weight:"bold",className:"da-api-token__modal-title",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Delete token"})}),(0,x.jsx)(o.Text,{as:"p",color:"prominent ",size:"xs",line_height:"m",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Are you sure you want to delete this token?"})})]}),(0,x.jsxs)(o.Modal.Footer,{className:"da-api-token__modal-footer",children:[(0,x.jsx)(o.Button,{className:"dc-dialog__button",has_effect:!0,onClick:()=>_(!1),secondary:!0,large:!0,children:(0,x.jsx)(d.Localize,{i18n_default_text:"Cancel"})}),(0,x.jsx)(o.Button,{className:"dc-dialog__button",has_effect:!0,onClick:async()=>{p(!0),await i(s.token??""),j()&&(p(!1),_(!1))},primary:!0,large:!0,is_loading:m,children:(0,x.jsx)(d.Localize,{i18n_default_text:"Yes, delete"})})]})]}),(0,x.jsx)(o.Popover,{alignment:t,classNameBubble:"dc-clipboard__popover",message:(0,x.jsx)(d.Localize,{i18n_default_text:"Delete this token"}),relative_render:!1,zIndex:"9999",is_open:u,children:(0,x.jsx)(o.Icon,{icon:"IcDelete",custom_color:"var(--text-prominent)",className:"dc-clipboard da-api-token__delete-icon",onClick:()=>{n&&h(!1),_(!0)},size:14,data_testid:"dt_token_delete_icon",onMouseEnter:()=>{!c&&n&&h(!0)},onMouseLeave:()=>{!c&&n&&h(!1)}})})]})},f=e=>{let{className:s,children:t,should_bypass_text:a}=e;return a?(0,x.jsx)("td",{className:(0,n.A)("da-api-token__table-cell",s),children:t}):(0,x.jsx)("td",{className:(0,n.A)("da-api-token__table-cell",s),children:(0,x.jsx)(o.Text,{color:"prominent ",size:"xs",line_height:"m",children:t})})},y=e=>{let{text:s}=e;return(0,x.jsx)("th",{className:"da-api-token__table-header",children:(0,x.jsx)(o.Text,{color:"prominent ",size:"xs",line_height:"m",weight:"bold",children:s})})},b=()=>(0,x.jsx)("div",{"data-testid":"dt_hidden_tokens",className:"da-api-token__pass-dot-container",children:Array.from(Array(15).keys()).map((e=>(0,x.jsx)("div",{className:"da-api-token__pass-dot"},e)))}),v=e=>{let{token:s,scopes:t}=e;const[n,i]=(0,a.useState)(!1);return(0,x.jsxs)("div",{className:"da-api-token__clipboard-wrapper",children:[n?(0,x.jsx)(o.Text,{as:"p",color:"prominent ",size:"xs",line_height:"m",children:s}):(0,x.jsx)(b,{}),(0,x.jsx)(j,{info_message:(0,x.jsx)(d.Localize,{i18n_default_text:"Copy this token"}),success_message:(0,x.jsx)(d.Localize,{i18n_default_text:"Token copied!"}),text_copy:s,scopes:t}),(0,x.jsx)(o.Popover,{alignment:"bottom",classNameBubble:"dc-clipboard__popover",message:n?(0,x.jsx)(d.Localize,{i18n_default_text:"Hide this token"}):(0,x.jsx)(d.Localize,{i18n_default_text:"Show this token"}),children:(0,x.jsx)(o.Icon,{icon:n?"IcPasswordEyeVisible":"IcPasswordEyeHide",className:"da-api-token__visibility-icon",onClick:()=>{i((e=>!e))},width:15,custom_color:"var(--text-prominent)",data_testid:"dt_toggle_visibility_icon"})})]})},z=e=>{let{scopes:s}=e;return(0,x.jsx)("div",{className:"da-api-token__table-scopes-cell-block",children:s?.map((e=>(0,x.jsx)("div",{className:(0,n.A)("da-api-token__table-scope-cell",{"da-api-token__table-scope-cell-admin":"admin"===e.toLowerCase()}),children:e},e)))})},T=e=>{let{token:s}=e;return(0,x.jsxs)("tr",{className:"da-api-token__table-cell-row",children:[(0,x.jsx)(f,{className:"da-api-token__table-cell--name",children:s.display_name}),(0,x.jsx)(f,{should_bypass_text:!0,children:(0,x.jsx)(v,{token:s.token,scopes:s.formatted_scopes})}),(0,x.jsx)(f,{should_bypass_text:!0,children:(0,x.jsx)(z,{scopes:s.formatted_scopes})}),(0,x.jsx)(f,{children:s.last_used}),(0,x.jsx)(f,{should_bypass_text:!0,children:(0,x.jsx)(g,{token:s})})]})},N=()=>{const{api_tokens:e}=(0,a.useContext)(k),{isDesktop:s}=(0,l.Y)(),{localize:t}=(0,d.useTranslations)(),n=e=>{const s=e?.scopes?.map((e=>(e=>{switch(e){case"read":return t("Read");case"trade":return t("Trade");case"payments":return t("Payments");case"admin":return t("Admin");case"trading_information":return t("Trading information");default:return(e=>{const s=e.replace(/[-_]/g," ");return s[0].toUpperCase()+s.slice(1).toLowerCase()})(e)}})(e))),a=e?.last_used?(0,r.formatDate)(e.last_used,"DD/MM/YYYY"):t("Never");return{display_name:e.display_name,formatted_scopes:s??[],last_used:a,token:e.token}};return s?(0,x.jsxs)("table",{className:"da-api-token__table",children:[(0,x.jsx)("thead",{children:(0,x.jsxs)("tr",{className:"da-api-token__table-header-row",children:[(0,x.jsx)(y,{text:t("Name")}),(0,x.jsx)(y,{text:t("Token")}),(0,x.jsx)(y,{text:t("Scopes")}),(0,x.jsx)(y,{text:t("Last used")}),(0,x.jsx)("th",{})]})}),(0,x.jsx)("tbody",{children:e?.map((e=>(0,x.jsx)(T,{token:n(e)},e?.token)))})]}):(0,x.jsx)(a.Fragment,{children:e?.map((e=>{const s=n(e);return(0,x.jsxs)("div",{className:"da-api-token__scope",children:[(0,x.jsx)("div",{className:"da-api-token__scope-item",children:(0,x.jsxs)("div",{children:[(0,x.jsx)(o.Text,{as:"h5",size:"xxs",color:"general",line_height:"xs",weight:"bold",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Name"})}),(0,x.jsx)(o.Text,{className:"da-api-token__scope-item--name",as:"p",size:"s",color:"general",line_height:"m",children:s.display_name})]})}),(0,x.jsxs)("div",{className:"da-api-token__scope-item",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)(o.Text,{as:"h5",size:"xxs",color:"general",line_height:"xs",weight:"bold",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Token"})}),(0,x.jsx)(v,{token:s.token,scopes:s.formatted_scopes})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)(o.Text,{as:"h5",size:"xxs",color:"general",line_height:"xs",weight:"bold",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Last Used"})}),(0,x.jsx)(o.Text,{as:"p",size:"s",color:"general",line_height:"m",children:s.last_used})]})]}),(0,x.jsxs)("div",{className:"da-api-token__scope-item",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)(o.Text,{as:"h5",size:"xxs",color:"general",line_height:"xs",weight:"bold",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Scopes"})}),(0,x.jsx)(z,{scopes:s.formatted_scopes})]}),(0,x.jsx)("div",{children:(0,x.jsx)(g,{token:s})})]})]},s.token)}))})};var w=t("./Components/load-error-message/index.ts");const L=[{name:"read",display_name:(0,x.jsx)(d.Localize,{i18n_default_text:"Read"}),description:(0,x.jsx)(d.Localize,{i18n_default_text:"This scope will allow third-party apps to view your account activity, settings, limits, balance sheets, trade purchase history, and more."})},{name:"trade",display_name:(0,x.jsx)(d.Localize,{i18n_default_text:"Trade"}),description:(0,x.jsx)(d.Localize,{i18n_default_text:"This scope will allow third-party apps to buy and sell contracts for you, renew your expired purchases, and top up your demo accounts."})},{name:"payments",display_name:(0,x.jsx)(d.Localize,{i18n_default_text:"Payments"}),description:(0,x.jsx)(d.Localize,{i18n_default_text:"This scope will allow third-party apps to withdraw to payment agents and make inter-account transfers for you."})},{name:"trading_information",display_name:(0,x.jsx)(d.Localize,{i18n_default_text:"Trading information"}),description:(0,x.jsx)(d.Localize,{i18n_default_text:"This scope will allow third-party apps to view your trading history."})},{name:"admin",display_name:(0,x.jsx)(d.Localize,{i18n_default_text:"Admin"}),description:(0,x.jsx)(d.Localize,{i18n_default_text:"This scope will allow third-party apps to open accounts for you, manage your settings and token usage, and more. "})}],C=/^[A-Za-z0-9\s_]+$/,A=e=>{let{icon:s,message:t,font_size:a="xxxs",icon_size:n=24,title:i}=e;return(0,x.jsxs)("div",{className:"da-inline-full-width-note-with-icon",children:[s&&(0,x.jsx)("div",{children:(0,x.jsx)(o.Icon,{icon:s,size:n})}),(0,x.jsxs)(o.Text,{as:"p",size:a,line_height:"s",children:[i&&(0,x.jsxs)("strong",{children:[" ",i," "]}),t]})]})},I=(0,c.observer)((()=>{const{client:e}=(0,c.useStore)(),{is_switching:s}=e,t=(0,a.useRef)(s),{isDesktop:_}=(0,l.Y)(),{localize:u}=(0,d.useTranslations)(),[h,j]=(0,a.useReducer)(((e,s)=>({...e,...s})),{api_tokens:[],is_loading:!0,is_success:!1,error_message:"",show_delete:!1,is_delete_loading:!1,is_delete_success:!1}),g=(0,a.useRef)(),f=(0,a.useRef)();(0,a.useEffect)((()=>(v(),()=>{clearTimeout(g.current),clearTimeout(f.current)})),[]),(0,a.useEffect)((()=>{t.current!==s&&(t.current=s,v())}),[s]);const y=e=>Object.keys(e).filter((s=>"token_name"!==s&&Boolean(e[s]))),b=e=>{e.error?j({is_loading:!1,error_message:(0,r.getPropertyValue)(e,["error","message"])}):j({is_loading:!1,api_tokens:(0,r.getPropertyValue)(e,["api_token","tokens"])})},v=async()=>{j({is_loading:!0});const e=await r.WS.authorized.apiToken({api_token:1});b(e)},{api_tokens:z,is_loading:T,is_success:I,error_message:M}=h;if(T||s)return(0,x.jsx)(o.Loading,{is_fullscreen:!1,className:"account__initial-loader"});if(M)return(0,x.jsx)(w.A,{error_message:M});if(void 0===z)return null;const S={api_tokens:z,deleteToken:async e=>{j({is_delete_loading:!0});const s=await r.WS.authorized.apiToken({api_token:1,delete_token:e});b(s),j({is_delete_loading:!1,is_delete_success:!0}),f.current=setTimeout((()=>{j({is_delete_success:!1})}),500)}};return(0,x.jsx)(k.Provider,{value:S,children:(0,x.jsx)("section",{className:"da-api-token",children:(0,x.jsxs)("div",{className:"da-api-token__wrapper",children:[(0,x.jsxs)(o.ThemedScrollbars,{className:"da-api-token__scrollbars",is_bypassed:!_,children:[!_&&(0,x.jsx)(m,{}),(0,x.jsx)(i.Formik,{initialValues:{token_name:"",read:!1,trade:!1,payments:!1,trading_information:!1,admin:!1},onSubmit:async(e,s)=>{let{setSubmitting:t,setFieldError:a,resetForm:n}=s;const i=await r.WS.apiToken({api_token:1,new_token:e.token_name,new_token_scopes:y(e)});i.error?a("token_name",i.error.message):(j({is_success:!0,api_tokens:(0,r.getPropertyValue)(i,["api_token","tokens"])}),g.current=setTimeout((()=>{j({is_success:!1})}),500)),n(),t(!1)},validate:e=>{const s={},t=e?.token_name?.trim();return t?C.test(t)?t.length<2?s.token_name=u("Length of token name must be between {{MIN_TOKEN}} and {{MAX_TOKEN}} characters.",{MIN_TOKEN:2,MAX_TOKEN:32}):t.length>32&&(s.token_name=u("Maximum {{MAX_TOKEN}} characters.",{MAX_TOKEN:32})):s.token_name=u("Only letters, numbers, and underscores are allowed."):s.token_name=u("Please enter a token name."),s},children:e=>{let{values:s,errors:t,isValid:a,dirty:l,touched:r,handleChange:c,handleBlur:_,isSubmitting:m,setFieldTouched:h}=e;return(0,x.jsxs)(i.Form,{noValidate:!0,children:[(0,x.jsx)(A,{icon:"IcAppstoreNewWarning",font_size:"xs",message:(0,x.jsx)(d.Localize,{i18n_default_text:"To avoid loss of funds, do not share tokens with <0>unauthorised</0> parties, especially the tokens with any of the following scopes: <0>Payments</0>, <0>Admin</0>, or <0>Trade</0>.",components:[(0,x.jsx)("strong",{},0)]})}),(0,x.jsxs)(o.Timeline,{className:"da-api-token__timeline",line_height:"xxxl",children:[(0,x.jsx)(o.Timeline.Item,{item_title:(0,x.jsx)(d.Localize,{i18n_default_text:"Select scopes based on the access you need."}),children:(0,x.jsx)("div",{className:"da-api-token__checkbox-wrapper",children:L.map((e=>(0,x.jsx)(p,{name:e.name,display_name:e.display_name,description:e.description},e.name)))})}),(0,x.jsx)(o.Timeline.Item,{item_title:(0,x.jsx)(d.Localize,{i18n_default_text:"Name your token and click on 'Create' to generate your token."}),children:(0,x.jsxs)("div",{className:"da-api-token__input-group",children:[(0,x.jsx)(i.Field,{name:"token_name",children:e=>{let{field:a}=e;return(0,x.jsx)(o.Input,{...a,"data-lpignore":"true",type:"text",className:"da-api-token__input dc-input__input-group",label:u("Token name"),value:s.token_name,onChange:e=>{h("token_name",!0),c(e)},onBlur:_,hint:(0,x.jsx)(d.Localize,{i18n_default_text:"Length of token name must be between 2 and 32 characters."}),required:!0,error:r.token_name&&t.token_name?t.token_name:void 0})}}),(0,x.jsx)(o.Button,{className:(0,n.A)("dc-btn__button-group","da-api-token__button",{"da-api-token__button--success":I}),type:"submit",is_disabled:!l||m||!a||!y(s).length,has_effect:!0,is_loading:m,is_submit_success:I,primary:!0,large:!0,children:(0,x.jsx)(d.Localize,{i18n_default_text:"Create"})})]})}),(0,x.jsx)(o.Timeline.Item,{item_title:(0,x.jsx)(d.Localize,{i18n_default_text:"Copy and paste the token into the app."}),children:(0,x.jsx)(N,{})})]})]})}})]}),_&&(0,x.jsx)(m,{})]})})})}))}}]);