"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7884],{499399:(e,s,r)=>{r.r(s),r.d(s,{default:()=>S});var a=r(286326),i=r(592353),t=r(391289),n=r(679955),o=r(414646),l=r(255530),d=r.n(l),c=r(824223),_=r(828112),u=r(189137),p=r(33118),m=r(836870);const g=()=>(0,m.jsxs)("div",{className:"link-expired__spaced-container__content link-expired__spaced-container__email_sent",children:[(0,m.jsx)(i.Icon,{data_testid:"dt_email-resent",icon:"IcEmailVerificationResent",size:128}),(0,m.jsx)(i.Text,{as:"p",size:"s",align:"center",children:(0,m.jsx)(p.Localize,{i18n_default_text:"<0>We've sent you an email.</0>",components:[(0,m.jsx)("strong",{},0)]})}),(0,m.jsx)(i.Text,{as:"p",size:"s",align:"center",children:(0,m.jsx)(p.Localize,{i18n_default_text:"Please click on the link in the email to reset your password."})})]}),w=(0,n.observer)((()=>{const{ui:e,client:s}=(0,o.A)(),{setPreventRedirectToHub:r}=s,{enableApp:t,disableApp:n,is_link_expired_modal_visible:l,toggleLinkExpiredModal:w}=e,{send:x,error:b,data:h}=(0,_.A)("reset_password"),[f,v]=a.useState(!1),j=(0,c.useFormik)({initialValues:{email:""},initialStatus:{error_msg:""},validate:e=>(0,u.validEmail)(e.email)?{}:{email:(0,u.getErrorMessages)().email()},onSubmit:e=>x(e.email)}),{errors:y,handleBlur:k,handleChange:S,handleSubmit:z,isSubmitting:N,resetForm:P,setStatus:A,setSubmitting:L,status:C,touched:T,values:E}=j;return a.useEffect((()=>{h&&(L(!1),v(!0))}),[h,L]),a.useEffect((()=>{b&&"object"==typeof b&&"message"in b&&(P(),A({error_msg:null==b?void 0:b.message}))}),[b,P,A]),(0,m.jsx)("form",{onSubmit:z,children:(0,m.jsx)(i.Dialog,{className:d()("link-expired__spaced-container",{"link-expired__spaced-container__fullscreen":f}),is_visible:l,disableApp:n,enableApp:t,title:f?"":(0,p.localize)("Link expired"),has_close_icon:!0,onConfirm:()=>{w(!1),r(!1)},children:(0,m.jsx)("div",{className:"link-expired",children:f?(0,m.jsx)(g,{}):(0,m.jsxs)("div",{className:"link-expired__spaced-container__content",children:[(0,m.jsx)(i.Text,{as:"p",size:"xs",align:"left",children:(0,m.jsx)(p.Localize,{i18n_default_text:"The link you clicked has expired. Ensure to click the link in the latest email in your inbox. Alternatively, enter your email below and click <0>Resend email</0> for a new link.",components:[(0,m.jsx)("strong",{},0)]})}),(0,m.jsx)("fieldset",{className:"email-platform__content__fieldset",children:(0,m.jsx)(i.Input,{className:"email-input","data-lpignore":"true",type:"text",name:"email",id:"email",onChange:e=>{A({error_msg:""}),S(e)},disabled:N,onBlur:k,error:T.email&&y.email||C.error_msg,label:(0,p.localize)("Email address"),value:E.email})}),(0,m.jsx)(i.FormSubmitButton,{has_cancel:!0,cancel_label:(0,p.localize)("Close"),onCancel:()=>{w(!1),r(!1)},is_disabled:!E.email||!!y.email||N,is_loading:N,label:(0,p.localize)("Resend email")})]})})})})}));var x=r(983211),b=r(919796),h=r(160756);const f=(0,n.observer)((()=>{const{ui:e,client:s}=(0,o.A)(),{logout:r,verification_code:a,setVerificationCode:t,setPreventRedirectToHub:n}=s,l=/deriv\.(com)/.test(window.location.hostname)||/localhost:8443/.test(window.location.host),{disableApp:_,enableApp:g,is_loading:w,is_reset_password_modal_visible:f,toggleResetPasswordModal:v,toggleLinkExpiredModal:j}=e,{isTmbEnabled:y}=(0,h.A)(),{isDesktop:k}=(0,b.Y)(),S=async(e,s)=>{const a=await y();s.setSubmitting(!1);const i=null==e?void 0:e.code;i?"InvalidToken"===i?(v(!1),j(!0)):(s.resetForm({values:{password:""}}),s.setStatus({error_msg:null==e?void 0:e.message})):(n(!1),s.setStatus({reset_complete:!0}),r().then((()=>{if(l&&!a)try{(0,x.ZF)({redirectCallbackUri:`${window.location.origin}/callback`}).catch((e=>{console.error(e)}))}catch(e){console.error(e)}else(0,u.redirectToLogin)(!1,(0,p.getLanguage)())})))},z=()=>{n(!1),v(!1),(0,u.removeActionParam)("reset_password")};return(0,m.jsx)(c.Formik,{initialValues:{password:""},initialStatus:{reset_complete:!1,error_msg:""},validate:e=>{const s={};return(0,u.validLength)(e.password,{min:8,max:25})?(0,u.validPassword)(e.password)||(s.password=(0,u.getErrorMessages)().password()):s.password=(0,p.localize)("You should enter {{min_number}}-{{max_number}} characters.",{min_number:8,max_number:25}),s},onSubmit:(e,s)=>{const r={reset_password:1,new_password:e.password,verification_code:a.reset_password};u.WS.resetPassword(r).then((async e=>{e.error?S(null==e?void 0:e.error,s):S(null,s),t("","reset_password")}))},children:e=>{let{handleBlur:s,errors:r,values:a,touched:t,isSubmitting:n,handleChange:o,status:l}=e;return(0,m.jsx)(i.Dialog,{className:"reset-password__spaced-container",is_visible:f,disableApp:_,enableApp:g,is_loading:w,dismissable:l.error_msg,onConfirm:z,title:(0,p.localize)("Reset your password"),has_close_icon:!0,is_closed_on_cancel:!1,children:(0,m.jsx)("div",{className:"reset-password",children:(0,m.jsx)(c.Form,{children:l.reset_complete?(0,m.jsxs)("div",{className:"reset-password__password-set",children:[(0,m.jsx)(i.Text,{align:"center",as:"p",weight:"bold",className:"reset-password__heading",children:(0,m.jsx)(p.Localize,{i18n_default_text:"Your password has been changed"})}),(0,m.jsx)(i.Text,{align:"center",as:"p",size:"xxs",className:"reset-password__subtext",children:(0,m.jsx)(p.Localize,{i18n_default_text:"We will now redirect you to the login page."})})]}):(0,m.jsxs)("div",{className:"reset-password__password-selection",children:[(0,m.jsx)("fieldset",{className:"reset-password__fieldset",children:(0,m.jsx)(i.PasswordMeter,{input:a.password,has_error:!!(t.password&&r.password||l.error_msg),custom_feedback_messages:(0,u.getErrorMessages)().password_warnings,children:(0,m.jsx)(i.PasswordInput,{autoComplete:"new-password",className:"reset-password__password-field",name:"password",label:(0,p.localize)("Create a password"),onChange:o,onBlur:s,error:t.password&&r.password||l.error_msg,value:a.password,"data-lpignore":"true",required:!0})})}),(0,m.jsx)(i.Text,{align:"center",as:"p",size:"xxs",className:"reset-password__subtext",children:l.error_msg?(0,m.jsx)(p.Localize,{i18n_default_text:"{{error_msg}}",values:{error_msg:l.error_msg}}):(0,m.jsx)(p.Localize,{i18n_default_text:"Strong passwords contain at least 8 characters. combine uppercase and lowercase letters, numbers, and symbols."})}),k&&(0,m.jsx)("div",{className:"reset-password__divider"}),(0,m.jsx)(i.Button,{className:d()("reset-password__btn",{"reset-password__btn--disabled":!a.password||r.password||n}),type:"submit",is_disabled:!a.password||!!r.password||n,primary:!0,children:(0,m.jsx)(p.Localize,{i18n_default_text:"Reset my password"})})]})})})})}})}));var v=r(158965);function j(e,s){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);s&&(a=a.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),r.push.apply(r,a)}return r}function y(e){for(var s=1;s<arguments.length;s++){var r=null!=arguments[s]?arguments[s]:{};s%2?j(Object(r),!0).forEach((function(s){k(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}function k(e,s,r){return(s=function(e){var s=function(e,s){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,s||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"==typeof s?s:s+""}(s))in e?Object.defineProperty(e,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[s]=r,e}const S=(0,n.observer)((()=>{const{client:e,ui:s}=(0,o.A)(),{is_logged_in:r}=e,{is_link_expired_modal_visible:n}=s,[l,d]=a.useReducer(((e,s)=>y(y({},e),s)),{is_loading:!0,is_unlinking:!1});return a.useEffect((()=>{!async function(){if(r){var e;const s=await t.WS.wait("get_account_status");null!=s&&null!==(e=s.get_account_status)&&void 0!==e&&e.social_identity_provider?d({is_unlinking:!0,is_loading:!1}):d({is_unlinking:!1,is_loading:!1})}else d({is_unlinking:!1,is_loading:!1})}()}),[r]),l.is_loading?(0,m.jsx)(i.Loading,{is_fullscreen:!1}):l.is_unlinking?(0,m.jsx)(v.default,{}):n?(0,m.jsx)(w,{}):(0,m.jsx)(f,{})}))},158965:(e,s,r)=>{r.r(s),r.d(s,{default:()=>x});var a=r(286326),i=r(597598),t=r.n(i),n=r(255530),o=r.n(n),l=r(824223),d=r(592353),c=r(189137),_=r(33118),u=r(391289),p=r(679955),m=r(414646),g=r(836870);const w=e=>{let{logoutClient:s,social_identity_provider:r,toggleResetPasswordModal:i,verification_code:t,new_email:n}=e;const p=(0,c.getActionFromUrl)(),m=(e,s)=>{if(s.setSubmitting(!1),s.resetForm({password:""}),e)return console.error(e),void s.setStatus({error_msg:e});s.setStatus({reset_complete:!0})},w=(e,s)=>{e.error?m(e.error.message,s):m(null,s)};return(0,g.jsx)("div",{className:"unlink-password",children:(0,g.jsx)(l.Formik,{initialValues:{password:""},initialStatus:{reset_complete:!1,error_msg:""},validate:e=>{const s={};return(0,c.validLength)(e.password,{min:8,max:25})?(0,c.validPassword)(e.password)||(s.password=(0,c.getErrorMessages)().password()):s.password=(0,_.localize)("You should enter {{min_number}}-{{max_number}} characters.",{min_number:8,max_number:25}),s},onSubmit:(e,s)=>{if("social_email_change"===p){const r={change_email:"update",new_email:n,new_password:e.password,verification_code:t};u.WS.changeEmail(r).then((async e=>{w(e,s)}))}else{const r={reset_password:1,new_password:e.password,verification_code:t};u.WS.resetPassword(r).then((async e=>{w(e,s)}))}(0,c.removeActionParam)("social_email_change")},children:e=>{let{handleBlur:t,errors:n,values:u,touched:p,isSubmitting:m,handleChange:w,status:x}=e;return(0,g.jsx)(l.Form,{children:(0,g.jsx)(a.Fragment,{children:x.reset_complete?(0,g.jsxs)("div",{className:"unlink-password__password-success",children:[(0,g.jsx)(d.Icon,{className:"unlink-password__icon",icon:`IcUnlink${(0,c.toTitleCase)(r)}`,size:128}),(0,g.jsx)(d.Text,{as:"p",weight:"bold",className:"unlink-password__heading",children:(0,g.jsx)(_.Localize,{i18n_default_text:"Success!"})}),(0,g.jsx)(d.Text,{align:"center",as:"p",size:"xs",className:"unlink-password__subtext",children:(0,g.jsx)(_.Localize,{i18n_default_text:"Your Deriv account has been unlinked from your {{social_identity_provider}} account. You can now log in to Deriv using your new email address and password.",values:{social_identity_provider:(0,c.toTitleCase)(r)}})}),(0,g.jsx)(d.Button,{type:"button",onClick:()=>{i(!1),s().then((()=>{(0,c.redirectToLogin)(!1,(0,_.getLanguage)(),!1)}))},primary:!0,large:!0,children:(0,g.jsx)(_.Localize,{i18n_default_text:"Login now"})})]}):(0,g.jsxs)("div",{className:"unlink-password__set-password",children:[(0,g.jsx)(d.Text,{as:"p",weight:"bold",className:"unlink-password__heading",children:(0,g.jsx)(_.Localize,{i18n_default_text:"Deriv password"})}),(0,g.jsx)(d.Text,{as:"p",size:"xs",className:"unlink-password__subtext",children:(0,g.jsx)(_.Localize,{i18n_default_text:"Enter a new password for your Deriv account."})}),(0,g.jsx)("fieldset",{className:"unlink-password__input-field",children:(0,g.jsx)(d.PasswordMeter,{input:u.password,has_error:!(!p.password||!n.password),custom_feedback_messages:(0,c.getErrorMessages)().password_warnings,children:(0,g.jsx)(d.PasswordInput,{autoComplete:"new-password",className:"unlink-password__password-field",name:"password",label:(0,_.localize)("Deriv password"),onChange:w,onBlur:t,error:p.password&&n.password,value:u.password,"data-lpignore":"true",required:!0})})}),(0,g.jsx)(d.Text,{as:"p",size:"xs",className:"unlink-password__hint",children:x.error_msg?(0,_.localize)(x.error_msg):(0,g.jsx)(_.Localize,{i18n_default_text:"Strong passwords contain at least 8 characters, combine uppercase and lowercase letters, numbers, and symbols."})}),(0,g.jsx)(d.Button,{className:o()("unlink-password__btn",{"unlink-password__btn--disabled":!u.password||n.password||m}),type:"submit",is_disabled:!u.password||!!n.password||m,primary:!0,large:!0,children:(0,g.jsx)(_.Localize,{i18n_default_text:"Confirm"})})]})})})}})})};w.propTypes={logoutClient:t().func,toggleResetPasswordModal:t().func,verification_code:t().string,social_identity_provider:t().string};const x=(0,p.observer)((()=>{const{ui:e,client:s}=(0,m.A)(),{logout:r,social_identity_provider:a,verification_code:i}=s,{disableApp:t,enableApp:n,is_loading:o,is_reset_password_modal_visible:l,toggleResetPasswordModal:c}=e,_=i.reset_password,u=i.social_email_change,p=s.new_email.social_email_change;return(0,g.jsx)(d.Dialog,{className:"unlink-password__dialog",is_visible:l,disableApp:t,enableApp:n,is_loading:o,children:(0,g.jsx)(w,{logoutClient:r,social_identity_provider:a,toggleResetPasswordModal:c,verification_code:u||_,new_email:p})})}))},161808:(e,s,r)=>{r.d(s,{A:()=>i});var a=r(286326);const i=e=>{let{from:s,to:r=0,increment:i=!1}=e;const[t,n]=(0,a.useState)(s),[o,l]=(0,a.useState)(!1);(0,a.useEffect)((()=>{let e;return o&&(e=setTimeout((()=>{t===r?d():n((e=>i?e+1:e-1))}),1e3)),()=>clearTimeout(e)}),[t,o,r,i]);const d=()=>l(!1),c=()=>n(s);return{count:t,is_running:o,start:()=>l(!0),pause:d,reset:c,stop:()=>{d(),c()}}}},828112:(e,s,r)=>{r.d(s,{A:()=>o});var a=r(286326),i=r(108340),t=r(414646),n=r(161808);const o=e=>{const s=(0,i.A)("verify_email"),r=(0,n.A)({from:60}),{client:o}=(0,t.A)(),[l,d]=(0,a.useState)(0),c=(0,a.useCallback)((a=>{const i=null!=a?a:o.email;i&&(r.is_running||(r.reset(),r.start(),d((e=>e+1)),s.mutate({payload:{verify_email:i,type:e}})))}),[s,o.email,r,e]),_=(0,a.useCallback)((()=>{s.mutate({payload:{verify_email:o.email,type:e}})}),[s,o.email,e]);return{WS:s,is_loading:s.isLoading,error:s.error,data:s.data,counter:r.count,is_counter_running:r.is_running,sent_count:l,has_been_sent:0!==l,send:c,sendPhoneNumberVerifyEmail:_}}}}]);
//# sourceMappingURL=core.reset-or-unlink-password-modal.aa53866a7b67e8130830.js.map